<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Suitability Scorer</title>
    <!-- 
        *** FIX: Using a local path instead of CDN to avoid CSP blocking. ***
        You must download the content of https://cdn.tailwindcss.com/3.4.17
        and save it as 'tailwind.min.js' in the same directory as this file. 
    -->
    <script src="./tailwind.min.js"></script>
    <style>
        /* Custom styles for aesthetic enhancements */
        :root {
            --primary-color: #e51937; /* A deep red, similar to a car badge */
            --bg-color: #f7f9fb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
        }

        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 1rem;
            background-color: white;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .primary-btn {
            background-color: var(--primary-color);
            transition: background-color 0.2s;
        }

        .primary-btn:hover {
            background-color: #c91530;
        }

        .match-badge {
            background-color: #ecfdf5; /* Light green */
            color: #059669; /* Dark green */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-800">Vehicle Suitability Scorer</h1>
            <p class="mt-2 text-xl text-gray-500">Test your model scoring logic with a simple, interactive questionnaire.</p>
        </header>

        <main class="grid lg:grid-cols-2 gap-8">
            <!-- Questionnaire Form -->
            <div id="questionnaire" class="card p-6 md:p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-700">User Profile</h2>
                <form id="car-quiz-form" class="space-y-6">

                    <!-- Q1: How many people (FILTER) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">1. How many people (and/or dogs!) are typically in your car? (Filter)</label>
                        <select name="people" id="people-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="1-2">1-2</option>
                            <option value="2-4">2-4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                    <!-- Q2: Perfect Car Vibe (MULTIPLE CHOICE - Score 1x per match, Max 2 pts) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">2. What car feels right to you? (Score 1x per match)</label>
                        <div class="space-y-2 mt-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="vibe" value="Small, nimble, practical" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Small, nimble, practical (City cars)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="vibe" value="Mid-sized, compact, fun" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Mid-sized, compact, fun (Hatchbacks)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="vibe" value="Mid-sized, SUV-style, sleek" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Mid-sized, SUV-style, sleek (Compact SUVs)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="vibe" value="Spacious, family-friendly" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Spacious, family-friendly (Large SUVs/Crossovers)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Q3: Driving Distance Frequency (Weighted 3x) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">3. How often do you drive +X miles? (3x Weight)</label>
                        <select name="longDistanceFrequency" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="Daily">Daily</option>
                            <option value="Weekly">Weekly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="Rarely">Rarely</option>
                        </select>
                    </div>

                    <!-- Q4: Prioritise (Weighted 3x) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">4. Above all else, you prioritise... (3x Weight)</label>
                        <select name="prioritise" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="Design that stands out">Design that stands out</option>
                            <option value="Features and modern tech">Features and modern tech</option>
                            <option value="Comfort and space">Comfort and space</option>
                            <option value="The essentials, done right">The essentials, done right</option>
                        </select>
                    </div>

                    <!-- Q5: Typical Driving Day (Weighted 2x) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">5. What's your typical driving day? (2x Weight)</label>
                        <select name="drivingDay" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="City commutes and short trips">City commutes and short trips</option>
                            <option value="Always on-the-go with kids">Always on-the-go with kids</option>
                            <option value="High mileage motorway driving">High mileage motorway driving</option>
                        </select>
                    </div>
                    
                    <!-- Q6: High-end features (Weighted 1x per match) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">6. What high-end features, if any, do you look for? (1x Weight per Match. Note: Towing is a filter)</label>
                        <div class="space-y-2 mt-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="features" value="Panoramic sunroof" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Panoramic sunroof</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="features" value="High-end audio system" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">High-end audio system</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="features" value="Exciting colourways" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Exciting colourways</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="features" value="Capable of towing above 700 KGs" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <span class="ml-3 text-sm text-gray-600">Capable of towing above 700 KGs (Filter)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Q7: Charging Point Access (Weighted 2x) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">7. Do you have access to a charging point? (2x Weight)</label>
                        <select name="chargingAccess" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="At home">At home</option>
                            <option value="At work">At work</option>
                            <option value="Not currently, but I could install at home">Not currently, but I could install at home</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <button type="submit" class="w-full primary-btn text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg mt-4">
                        Find My Perfect Match
                    </button>
                </form>
            </div>

            <!-- Results Panel -->
            <div id="results" class="card p-6 md:p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-700">Recommended Models</h2>
                <div id="results-container" class="space-y-4">
                    <p class="text-gray-500 text-center py-4">Select your answers and click "Find My Perfect Match" to see the ranked recommendations.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. CAR MODEL DATA ---
        // Max Score: 15 points (Q2 max 2, Q3 max 3, Q4 max 3, Q5 max 2, Q6 max 3, Q7 max 2)
        const CAR_MODELS = [
            // Note: 'vibe' is now an array to allow for multiple matching tags.
            // Clio
            { name: "Clio", capacity: "1-2", vibe: ["Small, nimble, practical"], longDistanceFrequency: "Weekly", prioritise: "The essentials, done right", drivingDay: "Always on-the-go with kids", features: ["Exciting colourways"], towingWeight: 900, chargingAccess: "No", description: "Compact and efficient city car (Petrol/Hybrid)." },
            // R5 e-Tech Electric
            { name: "R5 e-Tech Electric", capacity: "2-4", vibe: ["Mid-sized, compact, fun"], longDistanceFrequency: "Rarely", prioritise: "Design that stands out", drivingDay: "City commutes and short trips", features: ["High-end audio system", "Exciting colourways"], towingWeight: 500, chargingAccess: "At home", description: "Fun, electric hatchback with bold design." },
            // R4 e-Tech Electric
            { name: "R4 e-Tech Electric", capacity: "2-4", vibe: ["Mid-sized, compact, fun"], longDistanceFrequency: "Rarely", prioritise: "Design that stands out", drivingDay: "City commutes and short trips", features: ["High-end audio system"], towingWeight: 750, chargingAccess: "At work", description: "Rugged electric crossover." },
            // Captur - Max 2 Vibe points
            { name: "Captur", capacity: "2-4", vibe: ["Mid-sized, SUV-style, sleek", "Spacious, family-friendly"], longDistanceFrequency: "Daily", prioritise: "Features and modern tech", drivingDay: "High mileage motorway driving", features: ["Panoramic sunroof", "High-end audio system", "Capable of towing above 700 KGs"], towingWeight: 1200, chargingAccess: "Not currently, but I could install at home", description: "Small SUV, versatile and connected (Hybrid/Petrol)." },
            // Symbioz
            { name: "Symbioz", capacity: "2-4", vibe: ["Mid-sized, SUV-style, sleek"], longDistanceFrequency: "Daily", prioritise: "Features and modern tech", drivingDay: "High mileage motorway driving", features: ["Panoramic sunroof", "High-end audio system"], towingWeight: 1000, chargingAccess: "At home", description: "Mid-sized family SUV (Hybrid/Petrol)." },
            // Megane
            { name: "Megane", capacity: "2-4", vibe: ["Mid-sized, compact, fun"], longDistanceFrequency: "Weekly", prioritise: "Design that stands out", drivingDay: "High mileage motorway driving", features: ["High-end audio system", "Bike rack"], towingWeight: 750, chargingAccess: "At home", description: "Sporty electric hatchback." },
            // Scenic - Max 2 Vibe points
            { name: "Scenic", capacity: "5", vibe: ["Spacious, family-friendly", "Mid-sized, SUV-style, sleek"], longDistanceFrequency: "Daily", prioritise: "Comfort and space", drivingDay: "High mileage motorway driving", features: ["Panoramic sunroof", "High-end audio system", "Capable of towing above 700 KGs"], towingWeight: 1500, chargingAccess: "At home", description: "Large, electric family SUV." },
            // Rafale
            { name: "Rafale", capacity: "5", vibe: ["Spacious, family-friendly"], longDistanceFrequency: "Daily", prioritise: "Design that stands out", drivingDay: "High mileage motorway driving", features: ["Panoramic sunroof", "High-end audio system", "Capable of towing above 700 KGs"], towingWeight: 1500, chargingAccess: "At work", description: "Coupe SUV with focus on design (Hybrid/Petrol)." },
            // Austral
            { name: "Austral", capacity: "5", vibe: ["Spacious, family-friendly"], longDistanceFrequency: "Daily", prioritise: "Comfort and space", drivingDay: "High mileage motorway driving", features: ["Panoramic sunroof", "High-end audio system", "Capable of towing above 700 KGs"], towingWeight: 1500, chargingAccess: "Not currently, but I could install at home", description: "Premium SUV with hybrid technology." },
            // Twingo
            { name: "Twingo", capacity: "1-2", vibe: ["Small, nimble, practical"], longDistanceFrequency: "Rarely", prioritise: "Design that stands out", drivingDay: "City commutes and short trips", features: [], towingWeight: 0, chargingAccess: "At home", description: "Electric city car." }
        ];

        // --- 2. DYNAMIC MAPPING DATA (Removed as Q2 is no longer dynamic) ---
        
        // --- 3. DYNAMIC UI LOGIC (Removed as Q2 is no longer dynamic) ---

        function updateVibeOptions() {
            // Function no longer needed, retained as a placeholder function name to avoid console errors 
            // if the onchange event is still mistakenly referenced.
        }


        // --- 4. SCORING LOGIC ---

        function calculateScore(userInput) {
            let rankedModels = [];

            CAR_MODELS.forEach(model => {
                let score = 0;
                let isFiltered = false;
                let matchDetails = [];

                // --- A. FILTERS (Pass/Fail) ---
                
                // F1: People Capacity Filter (STILL A FILTER)
                if (model.capacity !== userInput.people) {
                    isFiltered = true;
                    matchDetails.push({ key: "People", isMatch: false, reason: `Needs ${userInput.people} but model has ${model.capacity}` });
                } else {
                    matchDetails.push({ key: "People", isMatch: true, reason: `Matches capacity (${model.capacity})` });
                }

                // F2: Towing Filter (STILL A FILTER)
                const wantsTowing = userInput.features.includes("Capable of towing above 700 KGs");
                if (wantsTowing && model.towingWeight < 700) {
                    isFiltered = true;
                    matchDetails.push({ key: "Towing", isMatch: false, reason: `Requires towing > 700kg, model has ${model.towingWeight}kg` });
                } else if (wantsTowing && model.towingWeight >= 700) {
                    matchDetails.push({ key: "Towing", isMatch: true, reason: `Towing match (has ${model.towingWeight}kg)` });
                } else if (!wantsTowing) {
                    matchDetails.push({ key: "Towing", isMatch: true, reason: "Towing not required by user" });
                }


                // If the model is filtered, skip scoring
                if (isFiltered) {
                    rankedModels.push({ model: model.name, score: -1, isFiltered: true, matchDetails, description: model.description });
                    return;
                }
                
                // --- B. WEIGHTED SCORING (Max Score = 15 points) ---
                
                // W1: Vibe Score (1x Weight per match, Max 2 points) - NEW SCORING
                let vibeMatches = 0;
                userInput.vibe.forEach(userVibe => {
                    if (model.vibe.includes(userVibe)) {
                        score += 1;
                        vibeMatches++;
                    }
                });
                matchDetails.push({ key: "Vibe Match (1x per)", isMatch: vibeMatches > 0, reason: `Matched ${vibeMatches} Vibe tags (+${vibeMatches} pts)` });

                // W2: Distance Frequency (3x Weight)
                if (model.longDistanceFrequency === userInput.longDistanceFrequency) {
                    score += 3;
                    matchDetails.push({ key: "Distance Freq. (3x)", isMatch: true, reason: `Matched frequency: "${model.longDistanceFrequency}" (+3 pts)` });
                } else {
                    matchDetails.push({ key: "Distance Freq. (3x)", isMatch: false, reason: `Mismatched frequency: User wants "${userInput.longDistanceFrequency}"` });
                }

                // W3: Prioritise (3x Weight)
                if (model.prioritise === userInput.prioritise) {
                    score += 3;
                    matchDetails.push({ key: "Prioritise (3x)", isMatch: true, reason: `Matched priority: "${model.prioritise}" (+3 pts)` });
                } else {
                    matchDetails.push({ key: "Prioritise (3x)", isMatch: false, reason: `Mismatched priority: User wants "${userInput.prioritise}"` });
                }

                // W4: Driving Day (2x Weight)
                if (model.drivingDay === userInput.drivingDay) {
                    score += 2;
                    matchDetails.push({ key: "Driving Day (2x)", isMatch: true, reason: `Matched driving day: "${model.drivingDay}" (+2 pts)` });
                } else {
                    matchDetails.push({ key: "Driving Day (2x)", isMatch: false, reason: `Mismatched driving day: User wants "${userInput.drivingDay}"` });
                }

                // W5: High-end Features (1x Weight per match - Max 3 features)
                let featureMatches = 0;
                // Filter out the 'towing' feature from the user input since it was handled as a filter
                const userFeatures = userInput.features.filter(f => f !== "Capable of towing above 700 KGs");
                
                userFeatures.forEach(userFeature => {
                    if (model.features.includes(userFeature)) {
                        score += 1;
                        featureMatches++;
                        matchDetails.push({ key: `Feature: ${userFeature} (1x)`, isMatch: true, reason: `Feature included (+1 pt)` });
                    }
                });
                
                matchDetails.push({ 
                    key: "Feature Score", 
                    isMatch: featureMatches > 0, 
                    reason: `Total features matched: ${featureMatches} out of ${userFeatures.length} (+${featureMatches} pts)` 
                });
                
                // W6: Charging Access (2x Weight)
                if (model.chargingAccess === userInput.chargingAccess) {
                    score += 2;
                    matchDetails.push({ key: "Charging Access (2x)", isMatch: true, reason: `Matched access: "${model.chargingAccess}" (+2 pts)` });
                } else {
                    matchDetails.push({ key: "Charging Access (2x)", isMatch: false, reason: `Mismatched access: User wants "${userInput.chargingAccess}"` });
                }


                // Final Model Data
                rankedModels.push({
                    model: model.name,
                    score: score,
                    isFiltered: false,
                    matchDetails,
                    description: model.description
                });
            });

            // Sort models: Highest score first. Filtered models (score = -1) will automatically go to the bottom.
            rankedModels.sort((a, b) => b.score - a.score);

            return rankedModels;
        }

        // --- 5. UI RENDERING ---

        function renderResults(results) {
            const container = document.getElementById('results-container');
            container.innerHTML = '';

            const passedModels = results.filter(r => !r.isFiltered);
            const filteredModels = results.filter(r => r.isFiltered);

            if (passedModels.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-6 bg-red-50 rounded-lg border border-red-200">
                        <p class="font-semibold text-red-700">No models passed the essential filters.</p>
                        <p class="text-sm text-red-600 mt-1">Only the People (Q1) and Towing (Q6 checkbox) questions act as filters now. Please check these options.</p>
                    </div>
                `;
            } else {
                // Render Passed Models
                container.innerHTML += '<h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">Recommended & Scored Models</h3>';
                passedModels.forEach((result, index) => {
                    container.innerHTML += createModelCard(result, index + 1);
                });

                // Render Filtered Models
                if (filteredModels.length > 0) {
                    container.innerHTML += `
                        <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3 border-b pb-2">Filtered Out Models (${filteredModels.length})</h3>
                    `;
                    filteredModels.forEach(result => {
                        container.innerHTML += createFilteredCard(result);
                    });
                }
            }
        }

        function createModelCard(result, rank) {
            const totalScore = 15; // Max theoretical score is now 15
            const percentage = ((result.score / totalScore) * 100).toFixed(0);

            let detailsHtml = result.matchDetails.map(detail => `
                <li class="flex items-start text-xs ${detail.isMatch ? 'text-green-700' : 'text-red-700'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 mt-0.5 flex-shrink-0 ${detail.isMatch ? 'text-green-500' : 'text-red-500'}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        ${detail.isMatch ? '<path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />' : '<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />'}
                    </svg>
                    <span><strong>${detail.key}:</strong> ${detail.reason}</span>
                </li>
            `).join('');


            return `
                <div class="result-item p-4 border border-gray-200 rounded-lg transition duration-200 bg-white">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center space-x-3">
                            <span class="text-lg font-bold w-6 h-6 flex items-center justify-center rounded-full ${rank === 1 ? 'bg-yellow-400 text-gray-800' : 'bg-gray-100 text-gray-600'}">${rank}</span>
                            <h4 class="text-xl font-extrabold text-gray-800">${result.model}</h4>
                            <span class="match-badge px-2 py-0.5 text-xs font-semibold rounded-full">${percentage}% Suitability</span>
                        </div>
                        <div class="text-2xl font-bold text-red-600">${result.score} pts</div>
                    </div>
                    <p class="text-sm text-gray-500 mb-3">${result.description}</p>
                    
                    <details class="mt-2">
                        <summary class="text-sm font-semibold text-gray-600 cursor-pointer hover:text-red-600">
                            View Detailed Scoring Breakdown
                        </summary>
                        <ul class="mt-2 pl-2 space-y-1">
                            ${detailsHtml}
                        </ul>
                    </details>
                </div>
            `;
        }

        function createFilteredCard(result) {
            const filterFailures = result.matchDetails.filter(d => (d.key === 'People' || d.key === 'Towing') && !d.isMatch);
            const failureReason = filterFailures.map(f => f.reason).join('; ');

            return `
                <div class="result-item p-3 border-l-4 border-red-400 rounded-lg bg-red-50 flex justify-between items-center">
                    <div>
                        <h4 class="text-lg font-semibold text-red-800">${result.model}</h4>
                        <p class="text-xs text-red-600 mt-0.5">FILTERED: ${failureReason}</p>
                    </div>
                    <span class="text-sm font-medium text-red-500">Excluded</span>
                </div>
            `;
        }

        // --- 6. EVENT HANDLER & INITIALIZATION ---

        document.getElementById('car-quiz-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            
            // Collect user input from the form
            const userInput = {
                people: form.elements.people.value,
                vibe: Array.from(form.elements.vibe) // Q2 is now array of checked values
                        .filter(checkbox => checkbox.checked)
                        .map(checkbox => checkbox.value),
                longDistanceFrequency: form.elements.longDistanceFrequency.value, // Q3
                prioritise: form.elements.prioritise.value, // Q4
                drivingDay: form.elements.drivingDay.value, // Q5
                features: Array.from(form.elements.features) // Q6
                            .filter(checkbox => checkbox.checked)
                            .map(checkbox => checkbox.value),
                chargingAccess: form.elements.chargingAccess.value // Q7
            };

            const results = calculateScore(userInput);
            renderResults(results);
        });

        // Initialization now only sets the placeholder text, as Q2 is no longer dynamic
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('results-container').innerHTML = `
                <div class="text-center p-6 bg-gray-50 rounded-lg border border-gray-200">
                    <p class="font-semibold text-gray-600">Input your preferences on the left to start the scoring validation.</p>
                    <p class="text-sm text-gray-500 mt-1">Q2 (Vibe) is now multiple choice and contributes 1 point per match to the score! Total score is now based on a maximum of 15 points.</p>
                </div>
            `;
        });
    </script>
</body>
</html>